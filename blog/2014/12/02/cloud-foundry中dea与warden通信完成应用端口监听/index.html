<!DOCTYPE html>
<html lang="zh-cn">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Cloud Foundry中DEA与warden通信完成应用端口监听</title>
  <meta name="author" content="孙宏亮" />
  
  
  
  
  <meta name="keywords" content="dea, cloudfoundry">
  
  
  <meta name="description" content="在Cloud Foundry v2版本中，DEA为一个用户应用运行的控制模块，而应用的真正运行都是依附于warden。更具体的来说，是DEA接收到Cloud Controller的请求；DEA发送请求给warden server；warden server创建warden container并将用户应用droplet等环境配置好；DEA发送应用启动请求至warden serve；最后warden container执行启动脚本启动应用。本文主要具体描述，DEA如何与warden交互，以保证最终用户的应用可以成功绑定某一个端口，实现用户应用对外提供服务。">

  <meta name="generator" content="Hugo 0.68.3" />

  
  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  
  
  
  

  <link href="/css/all.css" rel="stylesheet">
  <link href="/css/bootstrap.min.css" rel="stylesheet">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.default.css" rel="stylesheet" id="theme-stylesheet">
  

  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />

  
  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  
  <link rel="alternate" href="https://Congrool.github.io/index.xml" type="application/rss+xml" title="浙大SEL实验室">

  
  
  
  
  
  
  <meta property="og:updated_time" content="2014-12-02T16:55:44Z">
  
    
    
    <meta property="article:section" content="cloudfoundry">
    <meta property="article:tag" content="dea">
    <meta property="article:tag" content="cloudfoundry">
    
    
    <meta property="article:published_time" content="2014-12-02T16:55:44Z">
    <meta property="article:modified_time" content="2014-12-02T16:55:44Z">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Cloud Foundry中DEA与warden通信完成应用端口监听">
  
  <meta name="twitter:description" content="在Cloud Foundry v2版本中，DEA为一个用户应用运行的控制模块，而应用的真正运行都是依附于warden。更具体的来说，是DEA接收到Cloud Controller的请求；DEA发送请求给warden server；warden server创建warden container并将用户应用droplet等环境配置好；DEA发送应用启动请求至warden serve；最后warden …">
  
  
</head>


  <body>

    <div id="all">

        <header class="navbar-affixed-top" data-spy="affix" data-offset-top="62">
    <div class="navbar navbar-default yamm" role="navigation" id="navbar" style="background-color:white;">    
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/">
                    <img src="/img/sel.png" alt="Cloud Foundry中DEA与warden通信完成应用端口监听" class="hidden-xs hidden-sm img-responsive">
                    
                    <span class="sr-only">Cloud Foundry中DEA与warden通信完成应用端口监听 - </span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only"></span>
                        <i class="fas fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  
                  <li class="dropdown">
                    
                    <a href="/">主页</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/blog/">博客</a>
                    
                  </li>

                  <li class="dropdown">
                    
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">社区 <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    
                      <li><a href="https://www.servicemesher.com/">ServiceMesh社区</a></li>
                    
                      <li><a href="">kubeedge社区</a></li>

                      <li><a href="http://www.icsoft.zju.edu.cn/index.php">浙江大学智能计算与软件中心</a></li>
                    
                  </ul>

                  <li class="dropdown">
                    
                    <a href="/archives/">归档</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">关于</a>
                    
                  </li>
                  
                </li>

                
                

                
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">    
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>
                </span>
                    </div>
                </form>
            </div>
            
        </div>
    </div>

    
</header>




        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Cloud Foundry中DEA与warden通信完成应用端口监听</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        
                          <p class="text-muted text-uppercase mb-small text-right">
                             <a href="#">孙宏亮</a>
                             | 
                            2014-12-02
                          </p>
                        

                        <div id="post-content">
                          <p>在Cloud Foundry v2版本中，DEA为一个用户应用运行的控制模块，而应用的真正运行都是依附于warden。更具体的来说，是DEA接收到Cloud Controller的请求；DEA发送请求给warden server；warden server创建warden container并将用户应用droplet等环境配置好；DEA发送应用启动请求至warden serve；最后warden container执行启动脚本启动应用。</p>

<p>本文主要具体描述，DEA如何与warden交互，以保证最终用户的应用可以成功绑定某一个端口，实现用户应用对外提供服务。</p>

<p>DEA在执行启动一个应用的时候，主要做到以下这些部分：promise_droplet, promise_container, 其中这两个部分并发完成；promise_extract_droplet, promise_exec_hook_script(“before_start”), promise_start等。代码如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#555">[</span>  
      promise_droplet,  
      promise_container  
    <span style="color:#555">].</span>each(<span style="color:#555">&amp;</span><span style="color:#fc3">:run</span>)<span style="color:#555">.</span>each(<span style="color:#555">&amp;</span><span style="color:#fc3">:resolve</span>)  
    
    <span style="color:#555">[</span>  
      promise_extract_droplet,  
      promise_exec_hook_script(<span style="color:#c30">&#39;before_start&#39;</span>),  
      promise_start  
    <span style="color:#555">].</span>each(<span style="color:#555">&amp;</span><span style="color:#fc3">:resolve</span>)  </code></pre></div>
<h2 id="promise-droplet"><strong>promise_droplet:</strong></h2>

<p>在这一个环节，DEA主要做的工作是将droplet下载本机，通过droplet_uri,其中基本的路径在/config/dea.yml中，为base_dir: /tmp/dea_ng, 因此最终DEA下载到的droplet存放于DEA组件所在的宿主机上。</p>

<h2 id="promise-container"><strong>promise_container:</strong></h2>

<p>该环节的工作主要完成创建一个warden container，随后可以为应用的运行提供一个合适的环境。promise_container的源码实现如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">promise_container</span>  
        <span style="color:#360">Promise</span><span style="color:#555">.</span>new <span style="color:#069;font-weight:bold">do</span> <span style="color:#555">|</span><span style="color:#366">p</span><span style="color:#555">|</span>
        bind_mounts <span style="color:#555">=</span> <span style="color:#555">[</span>{<span style="color:#c30">&#39;src_path&#39;</span> <span style="color:#555">=&gt;</span> droplet<span style="color:#555">.</span>droplet_dirname, <span style="color:#c30">&#39;dst_path&#39;</span> <span style="color:#555">=&gt;</span> droplet<span style="color:#555">.</span>droplet_dirname}<span style="color:#555">]</span>  
        with_network <span style="color:#555">=</span> <span style="color:#069">true</span>  
        container<span style="color:#555">.</span>create_container(  
            <span style="color:#fc3">bind_mounts</span>: bind_mounts <span style="color:#555">+</span> config<span style="color:#555">[</span><span style="color:#c30">&#39;bind_mounts&#39;</span><span style="color:#555">]</span>,  
            <span style="color:#fc3">limit_cpu</span>: config<span style="color:#555">[</span><span style="color:#c30">&#39;instance&#39;</span><span style="color:#555">][</span><span style="color:#c30">&#39;cpu_limit_shares&#39;</span><span style="color:#555">]</span>,  
            <span style="color:#fc3">byte</span>: disk_limit_in_bytes,  
            <span style="color:#fc3">inode</span>: config<span style="color:#555">.</span>instance_disk_inode_limit,  
            <span style="color:#fc3">limit_memory</span>: memory_limit_in_bytes,  
            <span style="color:#fc3">setup_network</span>: with_network)  
        attributes<span style="color:#555">[</span><span style="color:#c30">&#39;warden_handle&#39;</span><span style="color:#555">]</span> <span style="color:#555">=</span> container<span style="color:#555">.</span>handle  
        promise_setup_def create_container(params)  
        <span style="color:#555">[</span><span style="color:#fc3">:bind_mounts</span>, <span style="color:#fc3">:limit_cpu</span>, <span style="color:#fc3">:byte</span>, <span style="color:#fc3">:inode</span>, <span style="color:#fc3">:limit_memory</span>, <span style="color:#fc3">:setup_network</span><span style="color:#555">].</span>each <span style="color:#069;font-weight:bold">do</span> <span style="color:#555">|</span>param<span style="color:#555">|</span>  
        <span style="color:#069;font-weight:bold">raise</span> <span style="color:#360">ArgumentError</span>, <span style="color:#c30">&#34;expecting </span><span style="color:#a00">#{</span>param<span style="color:#555">.</span>to_s<span style="color:#a00">}</span><span style="color:#c30"> parameter to create container&#34;</span> <span style="color:#069;font-weight:bold">if</span> params<span style="color:#555">[</span>param<span style="color:#555">].</span>nil?  
    <span style="color:#069;font-weight:bold">end</span>  
    
    with_em <span style="color:#069;font-weight:bold">do</span>  
        new_container_with_bind_mounts(params<span style="color:#555">[</span><span style="color:#fc3">:bind_mounts</span><span style="color:#555">]</span>)  
        limit_cpu(params<span style="color:#555">[</span><span style="color:#fc3">:limit_cpu</span><span style="color:#555">]</span>)  
        limit_disk(<span style="color:#fc3">byte</span>: params<span style="color:#555">[</span><span style="color:#fc3">:byte</span><span style="color:#555">]</span>, <span style="color:#fc3">inode</span>: params<span style="color:#555">[</span><span style="color:#fc3">:inode</span><span style="color:#555">]</span>)  
        limit_memory(params<span style="color:#555">[</span><span style="color:#fc3">:limit_memory</span><span style="color:#555">]</span>)  
        setup_network <span style="color:#069;font-weight:bold">if</span> params<span style="color:#555">[</span><span style="color:#fc3">:setup_network</span><span style="color:#555">]</span>  
    <span style="color:#069;font-weight:bold">end</span>  
    endenvironment<span style="color:#555">.</span>resolve  
        <span style="color:#366">p</span><span style="color:#555">.</span>deliver  
        <span style="color:#069;font-weight:bold">end</span>  
    <span style="color:#069;font-weight:bold">end</span>  </code></pre></div>
<p>可以看到传入的参数主要有：</p>

<ul>
<li>bind_mounts：完成宿主机文件目录的路径mount到container内部；</li>
<li>limit_cpu：用于限制container的CPU资源分配；</li>
<li>byte：磁盘限额；</li>
<li>innode：磁盘的innode的限制</li>
<li>limit_memory：内存限额；</li>
<li>setup_network：网络的配置项。</li>
</ul>

<p>其中setup_network一直设置为true。 在container.create_container的方法实现中，有以下的方法，如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">create_container</span>(params)  
        <span style="color:#555">[</span><span style="color:#fc3">:bind_mounts</span>, <span style="color:#fc3">:limit_cpu</span>, <span style="color:#fc3">:byte</span>, <span style="color:#fc3">:inode</span>, <span style="color:#fc3">:limit_memory</span>, <span style="color:#fc3">:setup_network</span><span style="color:#555">].</span>each <span style="color:#069;font-weight:bold">do</span> <span style="color:#555">|</span>param<span style="color:#555">|</span>  
          <span style="color:#069;font-weight:bold">raise</span> <span style="color:#360">ArgumentError</span>, <span style="color:#c30">&#34;expecting </span><span style="color:#a00">#{</span>param<span style="color:#555">.</span>to_s<span style="color:#a00">}</span><span style="color:#c30"> parameter to createdef create_container(params)  
</span><span style="color:#c30">        [:bind_mounts, :limit_cpu, :byte, :inode, :limit_memory, :setup_network].each do |param|  
</span><span style="color:#c30">          raise ArgumentError, &#34;</span>expecting <span style="color:#09f;font-style:italic">#{param.to_s} parameter to create container&#34; if params[param].nil?  </span>
        <span style="color:#069;font-weight:bold">end</span>  
    
      with_em <span style="color:#069;font-weight:bold">do</span>  
          new_container_with_bind_mounts(params<span style="color:#555">[</span><span style="color:#fc3">:bind_mounts</span><span style="color:#555">]</span>)  
          limit_cpu(params<span style="color:#555">[</span><span style="color:#fc3">:limit_cpu</span><span style="color:#555">]</span>)  
          limit_disk(<span style="color:#fc3">byte</span>: params<span style="color:#555">[</span><span style="color:#fc3">:byte</span><span style="color:#555">]</span>, <span style="color:#fc3">inode</span>: params<span style="color:#555">[</span><span style="color:#fc3">:inode</span><span style="color:#555">]</span>)  
          limit_memory(params<span style="color:#555">[</span><span style="color:#fc3">:limit_memory</span><span style="color:#555">]</span>)  
          setup_network <span style="color:#069;font-weight:bold">if</span> params<span style="color:#555">[</span><span style="color:#fc3">:setup_network</span><span style="color:#555">]</span>  
      <span style="color:#069;font-weight:bold">end</span>  
    <span style="color:#069;font-weight:bold">end</span> container<span style="color:#c30">&#34; if params[param].nil?  
</span><span style="color:#c30">      end  
</span><span style="color:#c30">    
</span><span style="color:#c30">      with_em do  
</span><span style="color:#c30">        new_container_with_bind_mounts(params[:bind_mounts])  
</span><span style="color:#c30">        limit_cpu(params[:limit_cpu])  
</span><span style="color:#c30">        limit_disk(byte: params[:byte], inode: params[:inode])  
</span><span style="color:#c30">        limit_memory(params[:limit_memory])  
</span><span style="color:#c30">        setup_network if params[:setup_network]  
</span><span style="color:#c30">      end  
</span><span style="color:#c30">    end  </span></code></pre></div>
<p>主要关注一下setup_network方法，如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">setup_network</span>  
        request <span style="color:#555">=</span> <span style="color:#555">::</span><span style="color:#360">Warden</span><span style="color:#555">::</span><span style="color:#360">Protocol</span><span style="color:#555">::</span><span style="color:#360">NetInRequest</span><span style="color:#555">.</span>new(<span style="color:#fc3">handle</span>: handle)  
        response <span style="color:#555">=</span> call(<span style="color:#fc3">:app</span>, request)  
        network_ports<span style="color:#555">[</span><span style="color:#c30">&#39;host_port&#39;</span><span style="color:#555">]</span> <span style="color:#555">=</span> response<span style="color:#555">.</span>host_port  
        network_ports<span style="color:#555">[</span><span style="color:#c30">&#39;container_port&#39;</span><span style="color:#555">]</span> <span style="color:#555">=</span> response<span style="color:#555">.</span>container_port  
    
        request <span style="color:#555">=</span> <span style="color:#555">::</span><span style="color:#360">Warden</span><span style="color:#555">::</span><span style="color:#360">Protocol</span><span style="color:#555">::</span><span style="color:#360">NetInRequest</span><span style="color:#555">.</span>new(<span style="color:#fc3">handle</span>: handle)  
        response <span style="color:#555">=</span> call(<span style="color:#fc3">:app</span>, request)  
        network_ports<span style="color:#555">[</span><span style="color:#c30">&#39;console_host_port&#39;</span><span style="color:#555">]</span> <span style="color:#555">=</span> response<span style="color:#555">.</span>host_port  
        network_ports<span style="color:#555">[</span><span style="color:#c30">&#39;console_container_port&#39;</span><span style="color:#555">]</span> <span style="color:#555">=</span> response<span style="color:#555">.</span>container_port 
    
    <span style="color:#069;font-weight:bold">end</span>  </code></pre></div>
<p>从代码中可以看到，在setup_network中，主要完成了两次NetIn操作。对于NetIn操作，需要说明的是，完成的工作是将host主机上的端口映射到container内部的端口。换言之，将host_ip:port1映射到container_ip:port2，也就是说如果container在container_ip上监听的是端口port2，则host机器外部的请求访问host机器，并且端口为port1的时候，host的内核网络栈，会将请求转发给container的port2端口，其中使用的协议为DNAT协议。 因此，在以上的代码中实现了两次NetIn操作，也就是说将container的两个端口映射到了host宿主机，第一个端口用于container内应用的正常占用端口，第二个端口是用来为应用的console功能做服务。虽然container也分配了第二个端口，但是在而后的应用启动等中，该console_port都没有使用过，可见Cloud Foundry在这里只是预留了接口，但是没有真正利用起来。 以上主要描述了NetIn的功能，以下进入NetIn操作的源码实现。NetIn的源码实现，主要为warden server的部分。其中，是由DEA进程通过warden.sock和warden server建立通信，随后DEA进程发送NetIn请求给warden server，warden server最终处理该请求。 现在进入warden范畴，研究warden如何接收请求，并实现端口的映射。 在warden/lib/warden/server.rb中，大部分代码都是为了完成warden server的运行，在run！方法中，可以看到warden server另外还启动了一个unix domain server，代码如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    server <span style="color:#555">=</span> <span style="color:#555">::</span><span style="color:#360">EM</span><span style="color:#555">.</span>start_unix_domain_server(unix_domain_path, <span style="color:#360">ClientConnection</span>)  </code></pre></div>
<p>也就是说，warden server会通过整个unix domain server接收从DEA进程发送来的关于warden container的一系列请求，在ClientConnection类中定义，关于这部分请求如何处理的方法。 当unix domain server中ClientConnection类通过receive_data（data）方法来实现接收请求，代码如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">receive_data</span>(data)  
      @buffer <span style="color:#555">&lt;&lt;</span> data  
      @buffer<span style="color:#555">.</span>each_request <span style="color:#069;font-weight:bold">do</span> <span style="color:#555">|</span>request<span style="color:#555">|</span>  
        <span style="color:#069;font-weight:bold">begin</span>  
            receive_request(request)  
        <span style="color:#069;font-weight:bold">rescue</span> <span style="color:#555">=&gt;</span> e  
            close_connection_after_writing  
            logger<span style="color:#555">.</span>warn(<span style="color:#c30">&#34;Disconnected client after error&#34;</span>)  
            logger<span style="color:#555">.</span>log_exception(e)  
        <span style="color:#069;font-weight:bold">end</span>  
      <span style="color:#069;font-weight:bold">end</span>  
    <span style="color:#069;font-weight:bold">end</span>  </code></pre></div>
<p>从代码中可以看到，当buffer中有请求的时候，通过receive_request（request）方法来进一步提取请求。再进入receive_request(request)方法中，可以看到通过process（request）来处理请求。 接着进入真正请求处理的部分，也就时process（request）的实现：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">process</span>(request)  
        <span style="color:#069;font-weight:bold">case</span> request  
        <span style="color:#069;font-weight:bold">when</span> <span style="color:#360">Protocol</span><span style="color:#555">::</span><span style="color:#360">PingRequest</span>  
          response <span style="color:#555">=</span> request<span style="color:#555">.</span>create_response  
          send_response(response)  
    
        <span style="color:#069;font-weight:bold">when</span> <span style="color:#360">Protocol</span><span style="color:#555">::</span><span style="color:#360">ListRequest</span>  
          response <span style="color:#555">=</span> request<span style="color:#555">.</span>create_response  
          response<span style="color:#555">.</span>handles <span style="color:#555">=</span> <span style="color:#360">Server</span><span style="color:#555">.</span>container_klass<span style="color:#555">.</span>registry<span style="color:#555">.</span>keys<span style="color:#555">.</span>map(<span style="color:#555">&amp;</span><span style="color:#fc3">:to_s</span>)  
          send_response(response)  
    
        <span style="color:#069;font-weight:bold">when</span> <span style="color:#360">Protocol</span><span style="color:#555">::</span><span style="color:#360">EchoRequest</span>  
          response <span style="color:#555">=</span> request<span style="color:#555">.</span>create_response  
          response<span style="color:#555">.</span>message <span style="color:#555">=</span> request<span style="color:#555">.</span>message  
          send_response(response)  
    
        <span style="color:#069;font-weight:bold">when</span> <span style="color:#360">Protocol</span><span style="color:#555">::</span><span style="color:#360">CreateRequest</span>  
          container <span style="color:#555">=</span> <span style="color:#360">Server</span><span style="color:#555">.</span>container_klass<span style="color:#555">.</span>new  
          container<span style="color:#555">.</span>register_connection(<span style="color:#366">self</span>)  
          response <span style="color:#555">=</span> container<span style="color:#555">.</span>dispatch(request)  
          send_response(response)  
    
        <span style="color:#069;font-weight:bold">else</span>  
          <span style="color:#069;font-weight:bold">if</span> request<span style="color:#555">.</span>respond_to?(<span style="color:#fc3">:handle</span>)  
            container <span style="color:#555">=</span> find_container(request<span style="color:#555">.</span>handle)  
            process_container_request(request, container)  
          <span style="color:#069;font-weight:bold">else</span>  
            <span style="color:#069;font-weight:bold">raise</span> <span style="color:#360">WardenError</span><span style="color:#555">.</span>new(<span style="color:#c30">&#34;Unknown request: </span><span style="color:#a00">#{</span>request<span style="color:#555">.</span>class<span style="color:#555">.</span>name<span style="color:#555">.</span>split(<span style="color:#c30">&#34;::&#34;</span>)<span style="color:#555">.</span>last<span style="color:#a00">}</span><span style="color:#c30">&#34;</span>)  
          <span style="color:#069;font-weight:bold">end</span>  
        <span style="color:#069;font-weight:bold">end</span>  
    <span style="color:#069;font-weight:bold">rescue</span> <span style="color:#360">WardenError</span> <span style="color:#555">=&gt;</span> e  
        send_error(e)  
    <span style="color:#069;font-weight:bold">rescue</span> <span style="color:#555">=&gt;</span> e  
        logger<span style="color:#555">.</span>log_exception(e)  
        send_error(e)  
    <span style="color:#069;font-weight:bold">end</span>  </code></pre></div>
<p>可见，在warden server中，请求类型可以简单分为5种：PingRequest, ListRequest, EchoRequest, CreateRequest和其他请求，像NetIn请求则属于其他请求中的一种，程序执行进入case语句块的else分支，也就是：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#069;font-weight:bold">if</span> request<span style="color:#555">.</span>respond_to?(<span style="color:#fc3">:handle</span>)  
  container <span style="color:#555">=</span> find_container(request<span style="color:#555">.</span>handle)  
  process_container_request(request, container)  
<span style="color:#069;font-weight:bold">else</span>  
  <span style="color:#069;font-weight:bold">raise</span> <span style="color:#360">WardenError</span><span style="color:#555">.</span>new(<span style="color:#c30">&#34;Unknown request: </span><span style="color:#a00">#{</span>request<span style="color:#555">.</span>class<span style="color:#555">.</span>name<span style="color:#555">.</span>split(<span style="color:#c30">&#34;::&#34;</span>)<span style="color:#555">.</span>last<span style="color:#a00">}</span><span style="color:#c30">&#34;</span>)  
<span style="color:#069;font-weight:bold">end</span></code></pre></div>
<p>代码清晰可见，warden server首先通过handle找到具体是给哪一个warden container发送请求，然后调用process_container_request(request, container)方法。进入process_container_request(request, container)方法可以看到：加入请求类型不为StopRequest以及StreamRequest，则进入case语句块的else分支，执行代码：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">response <span style="color:#555">=</span> container<span style="color:#555">.</span>dispatch(request)  
     send_response(response)  </code></pre></div>
<p>可以看到，是调用了container.dispatch（request）方法才返回了response。 以下进入warden/lib/warden/container/base.rb文件中，该文件的dispatch方法主要实现了warden server接收到请求并预处理之后，如何分发执行具体的请求，代码如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">dispatch</span>(request, <span style="color:#555">&amp;</span>blk)  
        klass_name <span style="color:#555">=</span> request<span style="color:#555">.</span>class<span style="color:#555">.</span>name<span style="color:#555">.</span>split(<span style="color:#c30">&#34;::&#34;</span>)<span style="color:#555">.</span>last  
        klass_name <span style="color:#555">=</span> klass_name<span style="color:#555">.</span>gsub(<span style="color:#3aa">/Request$/</span>, <span style="color:#c30">&#34;&#34;</span>)  
        klass_name <span style="color:#555">=</span> klass_name<span style="color:#555">.</span>gsub(<span style="color:#3aa">/(.)([A-Z])/</span>) { <span style="color:#555">|</span>m<span style="color:#555">|</span> <span style="color:#c30">&#34;</span><span style="color:#a00">#{</span>m<span style="color:#555">[</span><span style="color:#f60">0</span><span style="color:#555">]</span><span style="color:#a00">}</span><span style="color:#c30">_</span><span style="color:#a00">#{</span>m<span style="color:#555">[</span><span style="color:#f60">1</span><span style="color:#555">]</span><span style="color:#a00">}</span><span style="color:#c30">&#34;</span> }  
        klass_name <span style="color:#555">=</span> klass_name<span style="color:#555">.</span>downcase  
    
        response <span style="color:#555">=</span> request<span style="color:#555">.</span>create_response  
    
        t1 <span style="color:#555">=</span> <span style="color:#360">Time</span><span style="color:#555">.</span>now  
    
        before_method <span style="color:#555">=</span> <span style="color:#c30">&#34;before_%s&#34;</span> <span style="color:#555">%</span> klass_name  
        hook(before_method, request, response)  
        emit(before_method<span style="color:#555">.</span>to_sym)  
    
        around_method <span style="color:#555">=</span> <span style="color:#c30">&#34;around_%s&#34;</span> <span style="color:#555">%</span> klass_name  
        hook(around_method, request, response) <span style="color:#069;font-weight:bold">do</span>  
            do_method <span style="color:#555">=</span> <span style="color:#c30">&#34;do_%s&#34;</span> <span style="color:#555">%</span> klass_name  
        <span style="color:#366">send</span>(do_method, request, response, <span style="color:#555">&amp;</span>blk)  
        <span style="color:#069;font-weight:bold">end</span>  
    
        after_method <span style="color:#555">=</span> <span style="color:#c30">&#34;after_%s&#34;</span> <span style="color:#555">%</span> klass_name  
        emit(after_method<span style="color:#555">.</span>to_sym)  
        hook(after_method, request, response)  
    
        t2 <span style="color:#555">=</span> <span style="color:#360">Time</span><span style="color:#555">.</span>ndef dispatch(request, <span style="color:#555">&amp;</span>blk)  
        klass_name <span style="color:#555">=</span> request<span style="color:#555">.</span>class<span style="color:#555">.</span>name<span style="color:#555">.</span>split(<span style="color:#c30">&#34;::&#34;</span>)<span style="color:#555">.</span>last  
        klass_name <span style="color:#555">=</span> klass_name<span style="color:#555">.</span>gsub(<span style="color:#3aa">/Request$/</span>, <span style="color:#c30">&#34;&#34;</span>)  
        klass_name <span style="color:#555">=</span> klass_name<span style="color:#555">.</span>gsub(<span style="color:#3aa">/(.)([A-Z])/</span>) { <span style="color:#555">|</span>m<span style="color:#555">|</span> <span style="color:#c30">&#34;</span><span style="color:#a00">#{</span>m<span style="color:#555">[</span><span style="color:#f60">0</span><span style="color:#555">]</span><span style="color:#a00">}</span><span style="color:#c30">_</span><span style="color:#a00">#{</span>m<span style="color:#555">[</span><span style="color:#f60">1</span><span style="color:#555">]</span><span style="color:#a00">}</span><span style="color:#c30">&#34;</span> }  
        klass_name <span style="color:#555">=</span> klass_name<span style="color:#555">.</span>downcase  
    
        response <span style="color:#555">=</span> request<span style="color:#555">.</span>create_response  
    
        t1 <span style="color:#555">=</span> <span style="color:#360">Time</span><span style="color:#555">.</span>now  
    
        before_method <span style="color:#555">=</span> <span style="color:#c30">&#34;before_%s&#34;</span> <span style="color:#555">%</span> klass_name  
        hook(before_method, request, response)  
        emit(before_method<span style="color:#555">.</span>to_sym)  
    
        around_method <span style="color:#555">=</span> <span style="color:#c30">&#34;around_%s&#34;</span> <span style="color:#555">%</span> klass_name  
        hook(around_method, request, response) <span style="color:#069;font-weight:bold">do</span>  
            do_method <span style="color:#555">=</span> <span style="color:#c30">&#34;do_%s&#34;</span> <span style="color:#555">%</span> klass_name  
            <span style="color:#366">send</span>(do_method, request, response, <span style="color:#555">&amp;</span>blk)  
        <span style="color:#069;font-weight:bold">end</span>  
    
        after_method <span style="color:#555">=</span> <span style="color:#c30">&#34;after_%s&#34;</span> <span style="color:#555">%</span> klass_name  
        emit(after_method<span style="color:#555">.</span>to_sym)  
        hook(after_method, request, response)  
    
        t2 <span style="color:#555">=</span> <span style="color:#360">Time</span><span style="color:#555">.</span>now  
    
        logger<span style="color:#555">.</span>info(<span style="color:#c30">&#34;%s (took %.6f)&#34;</span> <span style="color:#555">%</span> <span style="color:#555">[</span>klass_name, t2 <span style="color:#555">-</span> t1<span style="color:#555">]</span>,  
            <span style="color:#fc3">:request</span> <span style="color:#555">=&gt;</span> request<span style="color:#555">.</span>to_hash,  
            <span style="color:#fc3">:response</span> <span style="color:#555">=&gt;</span> response<span style="color:#555">.</span>to_hash)  
    
        response  
     endow  
    
        logger<span style="color:#555">.</span>info(<span style="color:#c30">&#34;%s (took %.6f)&#34;</span> <span style="color:#555">%</span> <span style="color:#555">[</span>klass_name, t2 <span style="color:#555">-</span> t1<span style="color:#555">]</span>,  
            <span style="color:#fc3">:request</span> <span style="color:#555">=&gt;</span> request<span style="color:#555">.</span>to_hash,  
            <span style="color:#fc3">:response</span> <span style="color:#555">=&gt;</span> response<span style="color:#555">.</span>to_hash)  
    
        response  
    <span style="color:#069;font-weight:bold">end</span>  </code></pre></div>
<p>首先提取出请求的类型名，如果是NetIn请求的话，提取出来的请求的类型名称为net_in，随后构建出方法明do_method，也就是do_net_in，接着就通过send(do_method, request, response, &amp;blk)方法，将参数发送给do_net_in方法。</p>

<p>现在就是进入warden/lib/warden/container/features/net.rb文件中, do_net_in方法实现如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">do_net_in</span>(request, response)  
        <span style="color:#069;font-weight:bold">if</span> request<span style="color:#555">.</span>host_port<span style="color:#555">.</span>nil?  
          host_port <span style="color:#555">=</span> <span style="color:#366">self</span><span style="color:#555">.</span>class<span style="color:#555">.</span>port_pool<span style="color:#555">.</span>acquire  
    
          <span style="color:#09f;font-style:italic">#Use same port on the container side as the host side if unspecified  </span>
          container_port <span style="color:#555">=</span> request<span style="color:#555">.</span>container_port <span style="color:#555">||</span> host_port  
    
          <span style="color:#09f;font-style:italic"># Port may be re-used after this container has been destroyed  </span>
          @resources<span style="color:#555">[</span><span style="color:#c30">&#34;ports&#34;</span><span style="color:#555">]</span> <span style="color:#555">&lt;&lt;</span> host_port  
          @acquired<span style="color:#555">[</span><span style="color:#c30">&#34;ports&#34;</span><span style="color:#555">]</span> <span style="color:#555">&lt;&lt;</span> host_port  
        <span style="color:#069;font-weight:bold">else</span>  
          host_port <span style="color:#555">=</span> request<span style="color:#555">.</span>host_port  
          container_port <span style="color:#555">=</span> request<span style="color:#555">.</span>container_port <span style="color:#555">||</span> host_port  
        <span style="color:#069;font-weight:bold">end</span>  
    
        _net_in(host_port, container_port)  
    
        @resources<span style="color:#555">[</span><span style="color:#c30">&#34;net_in&#34;</span><span style="color:#555">]</span> <span style="color:#555">||=</span> <span style="color:#555">[]</span>  
        @resources<span style="color:#555">[</span><span style="color:#c30">&#34;net_in&#34;</span><span style="color:#555">]</span> <span style="color:#555">&lt;&lt;</span> <span style="color:#555">[</span>host_port, container_port<span style="color:#555">]</span>  
    
        response<span style="color:#555">.</span>host_port      <span style="color:#555">=</span> host_port  
        response<span style="color:#555">.</span>container_port <span style="color:#555">=</span> container_port  
    <span style="color:#069;font-weight:bold">rescue</span> <span style="color:#360">WardenError</span>  
      <span style="color:#366">self</span><span style="color:#555">.</span>class<span style="color:#555">.</span>port_pool<span style="color:#555">.</span>release(host_port) <span style="color:#069;font-weight:bold">unless</span> request<span style="color:#555">.</span>host_port  
      <span style="color:#069;font-weight:bold">raise</span>  
    <span style="color:#069;font-weight:bold">end</span>  </code></pre></div>
<p>可见，如果请求端口没有指定的话，那么就使用代码host_port = self.class.port_pool.acquire来获取端口号，默认情况下，container端口号与host端口号保持一致，有了这两个端口号之后，执行代码_net_in(host_port, container_port)， 真正实现端口映射，如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_net_in</span>(host_port, container_port)  
      sh <span style="color:#360">File</span><span style="color:#555">.</span>join(container_path, <span style="color:#c30">&#34;net.sh&#34;</span>), <span style="color:#c30">&#34;in&#34;</span>, <span style="color:#fc3">:env</span> <span style="color:#555">=&gt;</span> {  
        <span style="color:#c30">&#34;HOST_PORT&#34;</span>      <span style="color:#555">=&gt;</span> host_port,  
        <span style="color:#c30">&#34;CONTAINER_PORT&#34;</span> <span style="color:#555">=&gt;</span> container_port,  
      }  
    <span style="color:#069;font-weight:bold">end</span>  </code></pre></div>
<p>可以清晰的看到是，使用了容器内部的net.sh脚本来实现端口映射。现在进入warden/root/linux/skeleton/net.sh脚本，进入参数为in的执行部分：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#c30">&#34;in&#34;</span>)  
        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">[</span> <span style="color:#555">-</span>z <span style="color:#c30">&#34;${HOST_PORT:-}&#34;</span> <span style="color:#555">]</span>; <span style="color:#069;font-weight:bold">then</span>  
            echo <span style="color:#c30">&#34;Please specify HOST_PORT...&#34;</span> <span style="color:#f60">1</span><span style="color:#555">&gt;&amp;</span><span style="color:#f60">2</span>  
            <span style="color:#366">exit</span> <span style="color:#f60">1</span>  
        fi  
        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">[</span> <span style="color:#555">-</span>z <span style="color:#c30">&#34;${CONTAINER_PORT:-}&#34;</span> <span style="color:#555">]</span>; <span style="color:#069;font-weight:bold">then</span>  
          echo <span style="color:#c30">&#34;Please specify CONTAINER_PORT...&#34;</span> <span style="color:#f60">1</span><span style="color:#555">&gt;&amp;</span><span style="color:#f60">2</span>  
          <span style="color:#366">exit</span> <span style="color:#f60">1</span>  
        fi  
        iptables <span style="color:#555">-</span>t nat <span style="color:#555">-</span>A <span style="color:#a00;background-color:#faa">$</span>{nat_instance_chain} \  
          <span style="color:#555">--</span>protocol tcp \  
          <span style="color:#555">--</span>destination <span style="color:#c30">&#34;${external_ip}&#34;</span> \  
          <span style="color:#555">--</span>destination<span style="color:#555">-</span>port <span style="color:#c30">&#34;${HOST_PORT}&#34;</span> \  
          <span style="color:#555">--</span>jump <span style="color:#360">DNAT</span> \  
          <span style="color:#555">--</span>to<span style="color:#555">-</span>destination <span style="color:#c30">&#34;${network_container_ip}:${CONTAINER_PORT}&#34;</span>  
        ;;  </code></pre></div>
<p>可见，该脚本这部分的功能是在host主机创建一条DNAT规则，使得host主机上所有HOST_PORT端口上的网络请求，都转发至network_container_ip:CONTAINER_PORT上，也就是完成了目标地址IP转变。</p>

<h2 id="promise-extract-droplet"><strong>promise_extract_droplet:</strong></h2>

<p>该环节主要完成的是让container运行脚本，使得container容器将位于host主机的droplet文件，解压至container内部，代码内容如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">    <span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">promise_extract_droplet</span>  
        <span style="color:#360">Promise</span><span style="color:#555">.</span>new <span style="color:#069;font-weight:bold">do</span> <span style="color:#555">|</span><span style="color:#366">p</span><span style="color:#555">|</span>  
          script <span style="color:#555">=</span> <span style="color:#c30">&#34;cd /home/vcap/ &amp;&amp; tar zxf </span><span style="color:#a00">#{</span>droplet<span style="color:#555">.</span>droplet_path<span style="color:#a00">}</span><span style="color:#c30">&#34;</span>  
          container<span style="color:#555">.</span>run_script(<span style="color:#fc3">:app</span>, script)  
          <span style="color:#366">p</span><span style="color:#555">.</span>deliver  
        <span style="color:#069;font-weight:bold">end</span>  
    <span style="color:#069;font-weight:bold">end</span>  </code></pre></div>
<h2 id="promise-exec-hook-script-before-start"><strong>promise_exec_hook_script(&lsquo;before_start&rsquo;)：</strong></h2>

<p>这部分主要完成的功能是让容器运行名为before_start的脚本，在老的版本中，该部分的设置默认为空。</p>

<h2 id="promise-start"><strong>promise_start:</strong></h2>

<p>这部分主要完成的是应用的启动。其中创建容器的时候，返回的端口号，会被DEA保存。最终，当DEA启动应用的时候，由于DEA会将端口号作为参数传递给应用程序的启动脚本，因此当应用启动时会自动去监听已经为它设置的端口，即完成端口监听。</p>

<h2 id="转载请注明出处"><strong>转载请注明出处。</strong></h2>

<p>这篇文档更多出于我本人的理解，肯定在一些地方存在不足和错误。希望本文能够对接触Cloud Foundry v2中warden模块以及应用端口映射的人有些帮助，如果你对这方面感兴趣，并有更好的想法和建议，也请联系我。</p>
                        </div>
                        
                        
                        
                        
                        
                        

                        
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
                        <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
                        <script type="text/javascript" src="/assets/js/md5.min.js"></script>
                        <div id="gitalk-container"></div>     
                        <script type="text/javascript">
                            var gitalk = new Gitalk({
                              clientID: '835183d2dcbd1167ac28', 
                            
                              clientSecret: 'd873919fac3cc76921ee0800172c2279bc612f8d', 
                            
                              repo: 'Sel-Website-talk',
                              owner: 'Peeknut',
                              admin: ['Peeknut','Rachel-Shao'],
                              id: location.href.split("/").pop().substring(0, 49),      
                              distractionFreeMode: false  
                            })
                            gitalk.render('gitalk-container')
                        </script> 
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">搜索栏</h3>
      
    </div>

    <div class="panel-body">
        
        <div class="search" id="search">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="请输入文章标题或摘要..." id="search-key">
                <input type="hidden" name="sitesearch" value="https://Congrool.github.io/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main" onclick="search()"><i class="fas fa-search"></i></button>
                </span>
            </div>
            <h1 id="search-tip" style="color: red;text-align: center;display: none;font-size: medium;">搜索中，请稍后 ...</h1>
        </div>
        <script type="text/javascript">
            
            window.onload = function() {
                      document.onkeydown = function(ev) {
                        var event = ev || event
                        if (event.keyCode == 13) {
                          search()
                        }
                      }
                    }
            
            function search() {
                    
                      key = document.getElementById("search-key").value;
                      if (key === "") {
                        
                        return;
                      }
                      key = key.toLowerCase();
                      document.getElementById("search-key").value = "";
                  
                      
                      document.getElementById("search-tip").innerText = "搜索中，请稍后 ...";
                      document.getElementById("search-tip").style.display = "block";
                  
                      
                      var el = document.getElementById('blog-listing-medium');
                      if (el == null) {
                        el = document.getElementById("blog-post")
                      }
                      var childs = el.childNodes;
                      for (var i = childs.length - 1; i >= 0; i--) {
                        el.removeChild(childs[i]);
                      }
                  
                      
                      xmltext = new XMLHttpRequest;
                      xmltext.open("GET", "/index.xml", false);
                      xmltext.send();
                      resp = xmltext.responseXML;
                      
                      items = resp.getElementsByTagName("item");
                      
                      var i = 0;
                      haveResult = false;
                      while (i < items.length) {
                        txt = items[i].getElementsByTagName("title")[0].innerHTML + items[i].getElementsByTagName("description")[0].innerHTML
                        txt = txt.toLowerCase();
                        if (txt.indexOf(key) > -1) {
                          haveResult = true;
                          title = items[i].getElementsByTagName("title")[0].innerHTML;
                          link = items[i].getElementsByTagName("link")[0].innerHTML;
                          time = items[i].getElementsByTagName("pubDate")[0].innerHTML;
                          mark = items[i].getElementsByTagName("description")[0].innerHTML;
                          time = time.slice(0, -5);
                          addItem(title, link, time, mark)
                        }
                        i++;
                      }
                      if (!haveResult) {
                        document.getElementById("search-tip").innerText = "搜索完毕，未发现结果 ...";
                        document.getElementById("search-tip").style.display = "block";
                      }

                      
                      var el = document.getElementById("blog-head");
                      el.innerHTML="Blogs"
                    }
                  
                    
                    function addItem(title, link, time, mark) {
                      document.getElementById("search-tip").style.display = "none";
                      tmpl = "<article class=\"post\" style=\"border-bottom: 1px solid #e6e6e6;\" >" +
                        "<header class=\"post-header\">" +
                        "<h1 class=\"post-title\"><a class=\"post-link\" href=\"" + link + "\" target=\"_blank\">" + title + "</a></h1>" +
                        "<div class=\"post-meta\">" +
                        " <span class=\"post-time\">" + time + "</span>" +
                        "</div>" +
                        " </header>" +
                        "<div class=\"post-content\">" +
                        "<div class=\"post-summary\">" + mark + "</div>" +
                        "<div class=\"read-more\">" +
                        "<a href=" + link + " class=\"read-more-link\" target=\"_blank\">阅读更多</a>" +
                        "</div>" +
                        " </div>" +
                        "</article>"
                      div = document.createElement("div")
                      div.innerHTML = tmpl;
                      var el = document.getElementById('blog-listing-medium');
                      if (el == null) {
                        el = document.getElementById("blog-post")
                      }
                      el.appendChild(div)
                    }
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    

        </script>
        
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">归档栏</h3>
        
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            
            <li>
                <a href="/categories/bosh">bosh (1)</a>
            </li>
            
            <li>
                <a href="/categories/cloud_controller_ng">cloud_controller_ng (1)</a>
            </li>
            
            <li>
                <a href="/categories/cloudfoundry">cloudfoundry (15)</a>
            </li>
            
            <li>
                <a href="/categories/containerd">containerd (1)</a>
            </li>
            
            <li>
                <a href="/categories/docker">docker (19)</a>
            </li>
            
            <li>
                <a href="/categories/etcd">etcd (1)</a>
            </li>
            
            <li>
                <a href="/categories/haproxy">haproxy (1)</a>
            </li>
            
            <li>
                <a href="/categories/healthmanager">healthmanager (1)</a>
            </li>
            
            <li>
                <a href="/categories/karmada">karmada (4)</a>
            </li>
            
            <li>
                <a href="/categories/kubeedge">kubeedge (5)</a>
            </li>
            
            <li>
                <a href="/categories/kubernetes">kubernetes (14)</a>
            </li>
            
            <li>
                <a href="/categories/network">network (1)</a>
            </li>
            
            <li>
                <a href="/categories/openyurt">openyurt (2)</a>
            </li>
            
            <li>
                <a href="/categories/service-mesh">service-mesh (4)</a>
            </li>
            
        </ul>
    </div>

</div>








<div class="panel sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">标签栏</h3>
        
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            
            <li>
                <a href="/tags/agent"><i class="fas fa-tags"></i> agent</a>
            </li>
            
            <li>
                <a href="/tags/apiserver"><i class="fas fa-tags"></i> apiserver</a>
            </li>
            
            <li>
                <a href="/tags/books"><i class="fas fa-tags"></i> books</a>
            </li>
            
            <li>
                <a href="/tags/bosh"><i class="fas fa-tags"></i> bosh</a>
            </li>
            
            <li>
                <a href="/tags/ccng"><i class="fas fa-tags"></i> ccng</a>
            </li>
            
            <li>
                <a href="/tags/cf-release"><i class="fas fa-tags"></i> cf-release</a>
            </li>
            
            <li>
                <a href="/tags/cgroups"><i class="fas fa-tags"></i> cgroups</a>
            </li>
            
            <li>
                <a href="/tags/cloudfoundry"><i class="fas fa-tags"></i> cloudfoundry</a>
            </li>
            
            <li>
                <a href="/tags/cloudnative"><i class="fas fa-tags"></i> cloudnative</a>
            </li>
            
            <li>
                <a href="/tags/collector"><i class="fas fa-tags"></i> collector</a>
            </li>
            
            <li>
                <a href="/tags/containerd"><i class="fas fa-tags"></i> containerd</a>
            </li>
            
            <li>
                <a href="/tags/cri"><i class="fas fa-tags"></i> cri</a>
            </li>
            
            <li>
                <a href="/tags/dea"><i class="fas fa-tags"></i> dea</a>
            </li>
            
            <li>
                <a href="/tags/docker"><i class="fas fa-tags"></i> docker</a>
            </li>
            
            <li>
                <a href="/tags/docker-network"><i class="fas fa-tags"></i> docker-network</a>
            </li>
            
            <li>
                <a href="/tags/edgecomputing"><i class="fas fa-tags"></i> edgecomputing</a>
            </li>
            
            <li>
                <a href="/tags/etcd"><i class="fas fa-tags"></i> etcd</a>
            </li>
            
            <li>
                <a href="/tags/gorouter"><i class="fas fa-tags"></i> gorouter</a>
            </li>
            
            <li>
                <a href="/tags/haproxy"><i class="fas fa-tags"></i> haproxy</a>
            </li>
            
            <li>
                <a href="/tags/healthmanager"><i class="fas fa-tags"></i> healthmanager</a>
            </li>
            
            <li>
                <a href="/tags/istio"><i class="fas fa-tags"></i> istio</a>
            </li>
            
            <li>
                <a href="/tags/karmada"><i class="fas fa-tags"></i> karmada</a>
            </li>
            
            <li>
                <a href="/tags/kubeedge"><i class="fas fa-tags"></i> kubeedge</a>
            </li>
            
            <li>
                <a href="/tags/kubelet"><i class="fas fa-tags"></i> kubelet</a>
            </li>
            
            <li>
                <a href="/tags/kubernetes"><i class="fas fa-tags"></i> kubernetes</a>
            </li>
            
            <li>
                <a href="/tags/libcontainer"><i class="fas fa-tags"></i> libcontainer</a>
            </li>
            
            <li>
                <a href="/tags/micro-service"><i class="fas fa-tags"></i> micro-service</a>
            </li>
            
            <li>
                <a href="/tags/namespace"><i class="fas fa-tags"></i> namespace</a>
            </li>
            
            <li>
                <a href="/tags/nats"><i class="fas fa-tags"></i> nats</a>
            </li>
            
            <li>
                <a href="/tags/news"><i class="fas fa-tags"></i> news</a>
            </li>
            
            <li>
                <a href="/tags/openyurt"><i class="fas fa-tags"></i> openyurt</a>
            </li>
            
            <li>
                <a href="/tags/pipework"><i class="fas fa-tags"></i> pipework</a>
            </li>
            
            <li>
                <a href="/tags/pouch"><i class="fas fa-tags"></i> pouch</a>
            </li>
            
            <li>
                <a href="/tags/runc"><i class="fas fa-tags"></i> runc</a>
            </li>
            
            <li>
                <a href="/tags/runtime"><i class="fas fa-tags"></i> runtime</a>
            </li>
            
            <li>
                <a href="/tags/security"><i class="fas fa-tags"></i> security</a>
            </li>
            
            <li>
                <a href="/tags/serverless"><i class="fas fa-tags"></i> serverless</a>
            </li>
            
            <li>
                <a href="/tags/service-mesh"><i class="fas fa-tags"></i> service-mesh</a>
            </li>
            
            <li>
                <a href="/tags/syslog_aggregator"><i class="fas fa-tags"></i> syslog_aggregator</a>
            </li>
            
        </ul>
    </div>

</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4></h4>

            <p><strong>关于我们：<strong> <p>浙大SEL实验室</p><p>地址：杭州市浙大路38号曹光彪西楼405室</p><p><strong></strong>
            <a href="/contact" class="btn btn-small btn-template-main" >跳转到关于</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>最新博客</h4>
            

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://Congrool.github.io/blog/2022/08/26/%E5%9F%BA%E4%BA%8Ekubeedge%E7%9A%84%E8%BE%B9%E7%BC%98%E8%8A%82%E7%82%B9%E5%88%86%E7%BB%84%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">
                          
                            <img src="/img/blogs/27/overview.png" class="img-responsive" alt="基于KubeEdge的边缘节点分组管理设计与实现">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://Congrool.github.io/blog/2022/08/26/%E5%9F%BA%E4%BA%8Ekubeedge%E7%9A%84%E8%BE%B9%E7%BC%98%E8%8A%82%E7%82%B9%E5%88%86%E7%BB%84%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">基于KubeEdge的边缘节点分组管理设计与实现</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://Congrool.github.io/blog/2021/09/22/%E5%A4%9A%E4%BA%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6karmada-scheduler%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E5%AE%9E%E7%8E%B0/">
                          
                            <img src="/img/blogs/20/karmada-scheduler.png" class="img-responsive" alt="多云环境下的资源调度：karmada scheduler的框架和实现">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://Congrool.github.io/blog/2021/09/22/%E5%A4%9A%E4%BA%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6karmada-scheduler%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E5%AE%9E%E7%8E%B0/">多云环境下的资源调度：karmada scheduler的框架和实现</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://Congrool.github.io/blog/2021/09/16/%E5%A4%9A%E4%BA%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E6%88%90%E5%91%98%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%9C%8B%E7%9C%8B%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEkarmada%E6%98%AF%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E7%9A%84/">
                          
                            <img src="/img/blogs/19/karmada-arch.jpg" class="img-responsive" alt="多云环境下的成员集群管理，看看开源项目karmada是如何做到的">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://Congrool.github.io/blog/2021/09/16/%E5%A4%9A%E4%BA%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E6%88%90%E5%91%98%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%9C%8B%E7%9C%8B%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEkarmada%E6%98%AF%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E7%9A%84/">多云环境下的成员集群管理，看看开源项目karmada是如何做到的</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4></h4>

            <p><strong>联系我们: 
                                    <p>团队负责人：丁轶群 yiqunding@zju.edu.cn</p>
                                    <p>网站维护人：刘佳文 839809484@qq.com</p>                
    </strong>

            

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright ©️ 2020 SEL Laboratory , ZJ University all rights reserved.</p>
            
            <p class="pull-right">
               <a href="https://bootstrapious.com/p/universal-business-e-commerce-template">Bootstrapious</a>.
              

               <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>.
            </p>
        </div>
    </div>
</div>





    </div>
    

    


<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>



<script src="/js/jquery.cookie.min.js"></script>
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.counterup.min.js"></script>
<script src="/js/jquery-parallax.js"></script>


<script src="/js/front.js"></script>


<script src="/js/owl.carousel.min.js"></script>



  </body>
</html>
