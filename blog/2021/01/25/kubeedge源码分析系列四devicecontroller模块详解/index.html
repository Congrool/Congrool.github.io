<!DOCTYPE html>
<html lang="zh-cn">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>kubeedge源码分析系列（四）：DeviceController模块详解</title>
  <meta name="author" content="毛金勇" />
  
  
  
  
  <meta name="keywords" content="kubeedge">
  
  
  <meta name="description" content="DeviceController属于KubeEdge的云端组件，负责设备管理。KubeEdge利用Kubernetes提供的CRD机制，对真实的物理设备进行抽象，通过自定义一个名为Device的自定义资源（Custom Resource）来描述设备的元数据以及状态。而DeviceController，顾名思义，就是这一资源的的控制器，由它负责云边的设备信息同步。">

  <meta name="generator" content="Hugo 0.68.3" />

  
  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  
  
  
  

  <link href="/css/all.css" rel="stylesheet">
  <link href="/css/bootstrap.min.css" rel="stylesheet">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.default.css" rel="stylesheet" id="theme-stylesheet">
  

  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />

  
  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  
  <link rel="alternate" href="https://Congrool.github.io/index.xml" type="application/rss+xml" title="浙大SEL实验室">

  
  
  
  
  
  
  <meta property="og:updated_time" content="2021-01-25T10:00:11Z">
  
    
    
    <meta property="article:section" content="kubeedge">
    <meta property="article:tag" content="kubeedge">
    
    
    <meta property="article:published_time" content="2021-01-25T10:00:11Z">
    <meta property="article:modified_time" content="2021-01-25T10:00:11Z">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="kubeedge源码分析系列（四）：DeviceController模块详解">
  
  <meta name="twitter:description" content="DeviceController属于KubeEdge的云端组件，负责设备管理。KubeEdge利用Kubernetes提供的CRD机制，对真实的物理设备进行抽象，通过自定义一个名为Device的自定义资源（Custom Resource）来描述设备的元数据以及状态。而DeviceController，顾名思义，就是这一资源的的控制器，由它负责云边的设备信息同步。">
  
  
</head>


  <body>

    <div id="all">

        <header class="navbar-affixed-top" data-spy="affix" data-offset-top="62">
    <div class="navbar navbar-default yamm" role="navigation" id="navbar" style="background-color:white;">    
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/">
                    <img src="/img/sel.png" alt="kubeedge源码分析系列（四）：DeviceController模块详解" class="hidden-xs hidden-sm img-responsive">
                    
                    <span class="sr-only">kubeedge源码分析系列（四）：DeviceController模块详解 - </span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only"></span>
                        <i class="fas fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  
                  <li class="dropdown">
                    
                    <a href="/">主页</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/blog/">博客</a>
                    
                  </li>

                  <li class="dropdown">
                    
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">社区 <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    
                      <li><a href="https://www.servicemesher.com/">ServiceMesh社区</a></li>
                    
                      <li><a href="">kubeedge社区</a></li>

                      <li><a href="http://www.icsoft.zju.edu.cn/index.php">浙江大学智能计算与软件中心</a></li>
                    
                  </ul>

                  <li class="dropdown">
                    
                    <a href="/archives/">归档</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">关于</a>
                    
                  </li>
                  
                </li>

                
                

                
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">    
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>
                </span>
                    </div>
                </form>
            </div>
            
        </div>
    </div>

    
</header>




        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>kubeedge源码分析系列（四）：DeviceController模块详解</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        
                          <p class="text-muted text-uppercase mb-small text-right">
                             <a href="#">毛金勇</a>
                             | 
                            2021-01-25
                          </p>
                        

                        <div id="post-content">
                          <p>本篇主要剖析了为自定义资源提供各种服务的控制器DeviceController的源码，分别从<code>upstream</code>和<code>downstream</code>两个独立的goroutine出发去追寻数据的流动过程。</p>

<h2 id="1-概述">1. 概述</h2>

<p>DeviceController属于KubeEdge的云端组件，负责设备管理。KubeEdge利用Kubernetes提供的<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">CRD机制</a>，对真实的物理设备进行抽象，通过自定义一个名为<code>Device</code>的自定义资源（Custom Resource）来描述设备的元数据以及状态。而DeviceController，顾名思义，就是这一资源的的控制器，由它负责云边的设备信息同步。在具体的实现中，DeviceController分为两个部分，会启动两个独立的goroutine，即<code>downstream</code>和<code>upstream</code>，其中<code>downstream</code>通过监听 Kubernetes API Server 将设备的状态更新由云端同步至边缘端；而<code>upstream</code>则负责订阅来自边缘端的消息，并将其同步至API Server中。</p>

<p>再具体分析这部分源码之前，需要明确两个概念，即<code>DeviceModel</code>和<code>DeviceInstance</code>。在KubeEdge中，DeviceController通过这两个概念对设备进行抽象。</p>

<ul>
<li><strong>DeviceModel</strong>：描述了设备的属性（properties），定义了访问这些属性的方式（property visitor）。我们可以将<code>DeviceModel</code>理解为一组设备的模板。<code>DeviceModel</code>的具体设计详见<a href="https://github.com/kubeedge/kubeedge/blob/master/docs/proposals/device-crd.md#device-model-type-definition">这里</a>。</li>
<li><strong>DeviceInstance</strong>：表示一个真实的设备实例。通过引用<code>DeviceModel</code>，创建一个设备实例。其中，<code>Device Spec</code>表示的设备的期望状态，而<code>Device Status</code>则表示设备的真实状态。<code>DeviceInstance</code>的具体设计详见<a href="https://github.com/kubeedge/kubeedge/blob/master/docs/proposals/device-crd.md#device-instance-type-definition">这里</a>。</li>
</ul>

<h2 id="2-源码分析">2. 源码分析</h2>

<h3 id="2-1-代码入口">2.1. 代码入口</h3>

<p>为了避免篇幅冗长，代码有部分省略。</p>

<p><code>DownstreamController</code>的定义如下，它的作用是watch kubernetes api server and send change to edge。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#09f;font-style:italic">// DownstreamController watch kubernetes api server and send change to edge
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">type</span> DownstreamController <span style="color:#069;font-weight:bold">struct</span> {
	kubeClient   <span style="color:#555">*</span>kubernetes.Clientset
	messageLayer messagelayer.MessageLayer

	deviceManager      <span style="color:#555">*</span>manager.DeviceManager
	deviceModelManager <span style="color:#555">*</span>manager.DeviceModelManager
	configMapManager   <span style="color:#555">*</span>manager.ConfigMapManager

	crdClient <span style="color:#555">*</span>rest.RESTClient
}</code></pre></div>
<p><code>UpstreamController</code>的定义如下，它的所用是subscribe messages from edge and sync to k8s api server。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#09f;font-style:italic">// UpstreamController subscribe messages from edge and sync to k8s api server
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">type</span> UpstreamController <span style="color:#069;font-weight:bold">struct</span> {
	crdClient    <span style="color:#555">*</span>rest.RESTClient
	messageLayer messagelayer.MessageLayer
	<span style="color:#09f;font-style:italic">// message channel
</span><span style="color:#09f;font-style:italic"></span>	deviceStatusChan <span style="color:#069;font-weight:bold">chan</span> model.Message

	<span style="color:#09f;font-style:italic">// downstream controller to update device status in cache
</span><span style="color:#09f;font-style:italic"></span>	dc <span style="color:#555">*</span>DownstreamController
}</code></pre></div>
<p>模块启动入口：cloud/pkg/devicecontroller/devicecontroller.go，DeviceController 主体逻辑如下，</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> (dc <span style="color:#555">*</span>DeviceController) <span style="color:#c0f">Start</span>() {
	downstream, err <span style="color:#555">:=</span> controller.<span style="color:#c0f">NewDownstreamController</span>()
	<span style="color:#555">...</span>
	upstream, err <span style="color:#555">:=</span> controller.<span style="color:#c0f">NewUpstreamController</span>(downstream)
	<span style="color:#555">...</span>
	downstream.<span style="color:#c0f">Start</span>()
	<span style="color:#09f;font-style:italic">// wait for downstream controller to start and load deviceModels and devices
</span><span style="color:#09f;font-style:italic"></span>	<span style="color:#09f;font-style:italic">// TODO think about sync
</span><span style="color:#09f;font-style:italic"></span>	time.<span style="color:#c0f">Sleep</span>(<span style="color:#f60">1</span> <span style="color:#555">*</span> time.Second)
	upstream.<span style="color:#c0f">Start</span>()
}</code></pre></div>
<h3 id="2-2-downstream">2.2. downstream</h3>

<h4 id="downstream-start">downstream.Start()</h4>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#09f;font-style:italic">// Start DownstreamController
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">func</span> (dc <span style="color:#555">*</span>DownstreamController) <span style="color:#c0f">Start</span>() <span style="color:#078;font-weight:bold">error</span> {
	klog.<span style="color:#c0f">Info</span>(<span style="color:#c30">&#34;Start downstream devicecontroller&#34;</span>)

	<span style="color:#069;font-weight:bold">go</span> dc.<span style="color:#c0f">syncDeviceModel</span>()

	<span style="color:#09f;font-style:italic">// Wait for adding all device model
</span><span style="color:#09f;font-style:italic"></span>	<span style="color:#09f;font-style:italic">// TODO need to think about sync
</span><span style="color:#09f;font-style:italic"></span>	time.<span style="color:#c0f">Sleep</span>(<span style="color:#f60">1</span> <span style="color:#555">*</span> time.Second)
	<span style="color:#069;font-weight:bold">go</span> dc.<span style="color:#c0f">syncDevice</span>()

	<span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">nil</span>
}</code></pre></div>
<p>可以看到，<code>downstreamcontroller</code>的启动函数非常简单，即由两个独立的goroutine分别运行<code>syncDeviceModel()</code>和<code>syncDevice()</code>。由于<code>DeviceModel</code>必须要在<code>Device</code>实例之前先创建好，因此<code>syncDeviceModel()</code>和<code>syncDevice()</code>的启动顺序不能变。不过目前的实现中，只是简单的通过sleep 1秒钟来解决两者的同步问题，这是比较粗糙的做法，这里也标注了 TODO，后续肯定是需要改进的。</p>

<h4 id="syncdevicemodel">syncDeviceModel()</h4>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#09f;font-style:italic">// syncDeviceModel is used to get events from informer
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">func</span> (dc <span style="color:#555">*</span>DownstreamController) <span style="color:#c0f">syncDeviceModel</span>() {
	<span style="color:#069;font-weight:bold">for</span> {
		<span style="color:#069;font-weight:bold">select</span> {
		<span style="color:#069;font-weight:bold">case</span> <span style="color:#555">&lt;-</span>beehiveContext.<span style="color:#c0f">Done</span>():
			klog.<span style="color:#c0f">Info</span>(<span style="color:#c30">&#34;stop syncDeviceModel&#34;</span>)
			<span style="color:#069;font-weight:bold">return</span>
		<span style="color:#069;font-weight:bold">case</span> e <span style="color:#555">:=</span> <span style="color:#555">&lt;-</span>dc.deviceModelManager.<span style="color:#c0f">Events</span>():
			deviceModel, ok <span style="color:#555">:=</span> e.Object.(<span style="color:#555">*</span>v1alpha2.DeviceModel)
			<span style="color:#555">...</span>
			<span style="color:#069;font-weight:bold">switch</span> e.Type {
			<span style="color:#069;font-weight:bold">case</span> watch.Added:
				dc.<span style="color:#c0f">deviceModelAdded</span>(deviceModel)
			<span style="color:#069;font-weight:bold">case</span> watch.Deleted:
				dc.<span style="color:#c0f">deviceModelDeleted</span>(deviceModel)
			<span style="color:#069;font-weight:bold">case</span> watch.Modified:
				dc.<span style="color:#c0f">deviceModelUpdated</span>(deviceModel)
			<span style="color:#069;font-weight:bold">default</span>:
				klog.<span style="color:#c0f">Warningf</span>(<span style="color:#c30">&#34;deviceModel event type: %s unsupported&#34;</span>, e.Type)
			}
		}
	}
}</code></pre></div>
<p>这部分的代码还是非常清晰的，从<code>deviceModelManager</code>获取<code>deviceModel</code>相关的事件，根据事件类型触发<code>deviceModel</code>的添加、删除、更新等操作：</p>

<ul>
<li>deviceModelAdded：该方法只会在本地缓存中添加一条记录，并不会真正的创建<code>deviceModel</code>实例；</li>
<li>deviceModelUpdated：该方法会更新缓存，并执行<code>updateAllConfigMaps()</code>，只不过后者还没有实现；</li>
<li>deviceModelDeleted：该方法目前只会在本地缓存中删掉这个记录，TODO中说明应该要删除这个<code>deviceModel</code>关联的所有设备，只不过目前还没有实现。</li>
</ul>

<h4 id="syncdevice">syncDevice()</h4>

<p><code>syncDevice()</code>部分的逻辑与<code>syncDeviceModel()</code>一致，从<code>deviceManager</code>获取<code>device</code>相关的事件，并根据事件类型触发<code>device</code>的添加、删除、更新等操作：</p>

<ul>
<li><p>deviceAdded：该方法相比于<code>deviceModelAdded()</code>要复杂很多。代码如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#09f;font-style:italic">// deviceAdded creates a device, adds in deviceManagers map, send a message to edge node if node selector is present.
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">func</span> (dc <span style="color:#555">*</span>DownstreamController) <span style="color:#c0f">deviceAdded</span>(device <span style="color:#555">*</span>v1alpha2.Device) {
	dc.deviceManager.Device.<span style="color:#c0f">Store</span>(device.Name, device) <span style="color:#09f;font-style:italic">//缓存
</span><span style="color:#09f;font-style:italic"></span>	<span style="color:#069;font-weight:bold">if</span> <span style="color:#366">len</span>(device.Spec.NodeSelector.NodeSelectorTerms) <span style="color:#555">!=</span> <span style="color:#f60">0</span> <span style="color:#555">&amp;&amp;</span> 
	 <span style="color:#366">len</span>(device.Spec.NodeSelector.NodeSelectorTerms[<span style="color:#f60">0</span>].MatchExpressions) <span style="color:#555">!=</span> <span style="color:#f60">0</span> <span style="color:#555">&amp;&amp;</span> 
 <span style="color:#366">len</span>(device.Spec.NodeSelector.NodeSelectorTerms[<span style="color:#f60">0</span>].MatchExpressions[<span style="color:#f60">0</span>].Values) <span style="color:#555">!=</span> <span style="color:#f60">0</span> {
		dc.<span style="color:#c0f">addToConfigMap</span>(device) <span style="color:#09f;font-style:italic">//根据device API创建configMap，相当于把配置写进去
</span><span style="color:#09f;font-style:italic"></span>		edgeDevice <span style="color:#555">:=</span> <span style="color:#c0f">createDevice</span>(device) <span style="color:#09f;font-style:italic">//根据device API创建types.Device
</span><span style="color:#09f;font-style:italic"></span>		
msg <span style="color:#555">:=</span> model.<span style="color:#c0f">NewMessage</span>(<span style="color:#c30">&#34;&#34;</span>)
		resource, err <span style="color:#555">:=</span> messagelayer.<span style="color:#c0f">BuildResource</span>(device.Spec.NodeSelector.NodeSelectorTerms[<span style="color:#f60">0</span>].MatchExpressions[<span style="color:#f60">0</span>].Values[<span style="color:#f60">0</span>], <span style="color:#c30">&#34;membership&#34;</span>, <span style="color:#c30">&#34;&#34;</span>)
		<span style="color:#555">...</span>
		msg.<span style="color:#c0f">BuildRouter</span>(modules.DeviceControllerModuleName, constants.GroupTwin, resource, model.UpdateOperation)

		content <span style="color:#555">:=</span> types.MembershipUpdate{AddDevices: []types.Device{ <span style="color:#09f;font-style:italic">//消息的内容
</span><span style="color:#09f;font-style:italic"></span>			edgeDevice,
		}}
		content.EventID = uuid.<span style="color:#c0f">NewV4</span>().<span style="color:#c0f">String</span>()
		content.Timestamp = time.<span style="color:#c0f">Now</span>().<span style="color:#c0f">UnixNano</span>() <span style="color:#555">/</span> <span style="color:#f60">1e6</span>
		msg.Content = content

		err = dc.messageLayer.<span style="color:#c0f">Send</span>(<span style="color:#555">*</span>msg) <span style="color:#09f;font-style:italic">//发送消息
</span><span style="color:#09f;font-style:italic"></span>		<span style="color:#555">...</span>
	}
}</code></pre></div></li>
</ul>

<p>首先，和<code>deviceModelAdded()</code>的逻辑一样，会在<code>deviceManager</code>中缓存一份。</p>

<p>然后，判断与该设备绑定的边缘节点是否为空，如果非空，就进入下一步。</p>

<p>随后调用<code>addToConfigMap()</code>创建一个configMap，configMap的作用非常重要，在边缘端mapper中，所有与设备相关的配置（比如说protocol、protocolVisitor等等）都是通过configMap获取的。因此，当在云端添加一个device时，就需要更新或创建对应的configMap。不过<code>addToConfigMap()</code>方法不会直接将configMap更新至边缘节点，只是在云端更新了，然后由edgecontroller watch到configMap的更新后，再同步到边缘节点。</p>

<p>接着调用<code>createDevice(device)</code>，这一步的作用是，由标准的<a href="https://github.com/kubeedge/kubeedge/blob/master/cloud/pkg/apis/devices/v1alpha2/device_instance_types.go#L360">Device API</a>转成<a href="https://github.com/kubeedge/kubeedge/blob/master/cloud/pkg/devicecontroller/types/device.go#L4">Device</a>，注意这两者的区别！前者是基于Kubernetes CRD机制定义的自定义资源（Custom Resource），是标准的Kubernetes API对象；后者用于云边通信（即cloudhub与edgehub之间的消息传输），也就是说，边缘端拿到的Device对象并不是标准的Device API。设备这一块的处理和其他内置资源（比如Pod、Service）不同，对于内置资源，都是把完整的API对象发往边缘端的；而设备的处理则定义很多其他的结构体（主要就是Device、MsgTwin、MsgAttr）用于云边的device数据传输。</p>

<p>最后就是创建消息msg，并将其发送至边缘端。注意，msg.Content 中存放的是 types.MembershipUpdate{}，里面是一个新增设备的列表。和edgecontroller不同的是，edgecontroller同步至边缘的消息中，content是Pod、ConfigMap等对象。</p>

<ul>
<li>deviceDeleted：删除设备与新增设备的逻辑基本一致，不再赘述。</li>

<li><p>deviceUpdated：设备更新的逻辑也比较复杂，该方法代码如下：</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#09f;font-style:italic">// deviceUpdated updates the map, check if device is actually updated.
</span><span style="color:#09f;font-style:italic">// If nodeSelector is updated, call add device for newNode, deleteDevice for old Node.
</span><span style="color:#09f;font-style:italic">// If twin is updated, send twin update message to edge
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">func</span> (dc <span style="color:#555">*</span>DownstreamController) <span style="color:#c0f">deviceUpdated</span>(device <span style="color:#555">*</span>v1alpha2.Device) {
	value, ok <span style="color:#555">:=</span> dc.deviceManager.Device.<span style="color:#c0f">Load</span>(device.Name)<span style="color:#09f;font-style:italic">//从缓存中取出old device
</span><span style="color:#09f;font-style:italic"></span>	dc.deviceManager.Device.<span style="color:#c0f">Store</span>(device.Name, device)
	<span style="color:#069;font-weight:bold">if</span> ok {
		cachedDevice <span style="color:#555">:=</span> value.(<span style="color:#555">*</span>v1alpha2.Device)
		<span style="color:#069;font-weight:bold">if</span> <span style="color:#c0f">isDeviceUpdated</span>(cachedDevice, device) {
			<span style="color:#09f;font-style:italic">// if node selector updated delete from old node and create in new node
</span><span style="color:#09f;font-style:italic"></span>			<span style="color:#069;font-weight:bold">if</span> <span style="color:#c0f">isNodeSelectorUpdated</span>(cachedDevice.Spec.NodeSelector, device.Spec.NodeSelector) {
				dc.<span style="color:#c0f">deviceAdded</span>(device)
				deletedDevice <span style="color:#555">:=</span> <span style="color:#555">&amp;</span>v1alpha2.Device{ObjectMeta: cachedDevice.ObjectMeta,
					Spec:     cachedDevice.Spec,
					Status:   cachedDevice.Status,
					TypeMeta: device.TypeMeta,
				}
				dc.<span style="color:#c0f">deviceDeleted</span>(deletedDevice)
			} <span style="color:#069;font-weight:bold">else</span> {
				<span style="color:#09f;font-style:italic">// update config map if spec, data or twins changed
</span><span style="color:#09f;font-style:italic"></span>				<span style="color:#069;font-weight:bold">if</span> <span style="color:#c0f">isProtocolConfigUpdated</span>(<span style="color:#555">&amp;</span>cachedDevice.Spec.Protocol, <span style="color:#555">&amp;</span>device.Spec.Protocol) <span style="color:#555">||</span>
					<span style="color:#c0f">isDeviceStatusUpdated</span>(<span style="color:#555">&amp;</span>cachedDevice.Status, <span style="color:#555">&amp;</span>device.Status) <span style="color:#555">||</span>
					<span style="color:#c0f">isDeviceDataUpdated</span>(<span style="color:#555">&amp;</span>cachedDevice.Spec.Data, <span style="color:#555">&amp;</span>device.Spec.Data) {
					dc.<span style="color:#c0f">updateConfigMap</span>(device)
				}
				<span style="color:#09f;font-style:italic">// update twin properties
</span><span style="color:#09f;font-style:italic"></span>				<span style="color:#069;font-weight:bold">if</span> <span style="color:#c0f">isDeviceStatusUpdated</span>(<span style="color:#555">&amp;</span>cachedDevice.Status, <span style="color:#555">&amp;</span>device.Status) {
					<span style="color:#09f;font-style:italic">// TODO: add an else if condition to check if DeviceModelReference has changed, if yes whether deviceModelReference exists
</span><span style="color:#09f;font-style:italic"></span>					twin <span style="color:#555">:=</span> <span style="color:#366">make</span>(<span style="color:#069;font-weight:bold">map</span>[<span style="color:#078;font-weight:bold">string</span>]<span style="color:#555">*</span>types.MsgTwin)
					<span style="color:#c0f">addUpdatedTwins</span>(device.Status.Twins, twin, device.ResourceVersion)
					<span style="color:#c0f">addDeletedTwins</span>(cachedDevice.Status.Twins, device.Status.Twins, twin, device.ResourceVersion)
					msg <span style="color:#555">:=</span> model.<span style="color:#c0f">NewMessage</span>(<span style="color:#c30">&#34;&#34;</span>)

					resource, err <span style="color:#555">:=</span> messagelayer.<span style="color:#c0f">BuildResource</span>(device.Spec.NodeSelector.NodeSelectorTerms[<span style="color:#f60">0</span>].MatchExpressions[<span style="color:#f60">0</span>].Values[<span style="color:#f60">0</span>], <span style="color:#c30">&#34;device/&#34;</span><span style="color:#555">+</span>device.Name<span style="color:#555">+</span><span style="color:#c30">&#34;/twin/cloud_updated&#34;</span>, <span style="color:#c30">&#34;&#34;</span>)
					<span style="color:#069;font-weight:bold">if</span> err <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
						klog.<span style="color:#c0f">Warningf</span>(<span style="color:#c30">&#34;Built message resource failed with error: %s&#34;</span>, err)
						<span style="color:#069;font-weight:bold">return</span>
					}
					msg.<span style="color:#c0f">BuildRouter</span>(modules.DeviceControllerModuleName, constants.GroupTwin, resource, model.UpdateOperation)
					content <span style="color:#555">:=</span> types.DeviceTwinUpdate{Twin: twin}
					content.EventID = uuid.<span style="color:#c0f">NewV4</span>().<span style="color:#c0f">String</span>()
					content.Timestamp = time.<span style="color:#c0f">Now</span>().<span style="color:#c0f">UnixNano</span>() <span style="color:#555">/</span> <span style="color:#f60">1e6</span>
					msg.Content = content

					err = dc.messageLayer.<span style="color:#c0f">Send</span>(<span style="color:#555">*</span>msg)
					<span style="color:#555">...</span>
				}
			}
		}
	} <span style="color:#069;font-weight:bold">else</span> {
		<span style="color:#09f;font-style:italic">// If device not present in device map means it is not modified and added.
</span><span style="color:#09f;font-style:italic"></span>		dc.<span style="color:#c0f">deviceAdded</span>(device)
	}
}</code></pre></div></li>
</ul>

<p>首先从缓存中取出old device，然后通过<code>isDeviceUpdated(cachedDevice, device)</code>比较new device与old device是否发生了更新；</p>

<p>如果是与设备绑定的NodeSelector发生了变化，处理方式是删除old device并添加new device；</p>

<p>如果是设备的spec, data or twins发生了变化，则更新configMap。前面已经提过了，边缘的Mapper就是靠configMap来获取设备的所有信息的；</p>

<p>另外，如果是设备孪生（twin）发生了变化，要需要向边缘端同步一条消息，而消息的内容是 DeviceTwinUpdate{Twin: twin}。</p>

<h3 id="2-3-upstream">2.3. upstream</h3>

<h4 id="upstream-start">upstream.Start()</h4>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#09f;font-style:italic">// Start UpstreamController
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">func</span> (uc <span style="color:#555">*</span>UpstreamController) <span style="color:#c0f">Start</span>() <span style="color:#078;font-weight:bold">error</span> {
	klog.<span style="color:#c0f">Info</span>(<span style="color:#c30">&#34;Start upstream devicecontroller&#34;</span>)

	uc.deviceStatusChan = <span style="color:#366">make</span>(<span style="color:#069;font-weight:bold">chan</span> model.Message, config.Config.Buffer.UpdateDeviceStatus)
	<span style="color:#069;font-weight:bold">go</span> uc.<span style="color:#c0f">dispatchMessage</span>()

	<span style="color:#069;font-weight:bold">for</span> i <span style="color:#555">:=</span> <span style="color:#f60">0</span>; i &lt; <span style="color:#366">int</span>(config.Config.Buffer.UpdateDeviceStatus); i<span style="color:#555">++</span> {
		<span style="color:#069;font-weight:bold">go</span> uc.<span style="color:#c0f">updateDeviceStatus</span>()
	}
	<span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">nil</span>
}</code></pre></div>
<p>upstream的启动函数也非常简单，只做两件事情，分发消息并更新Device API（即<code>Device.Status</code>部分）。</p>

<h4 id="dispatchmessage">dispatchMessage()</h4>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> (uc <span style="color:#555">*</span>UpstreamController) <span style="color:#c0f">dispatchMessage</span>() {
	<span style="color:#069;font-weight:bold">for</span> {
		<span style="color:#069;font-weight:bold">select</span> {
		<span style="color:#069;font-weight:bold">case</span> <span style="color:#555">&lt;-</span>beehiveContext.<span style="color:#c0f">Done</span>():
			klog.<span style="color:#c0f">Info</span>(<span style="color:#c30">&#34;Stop dispatchMessage&#34;</span>)
			<span style="color:#069;font-weight:bold">return</span>
		<span style="color:#069;font-weight:bold">default</span>:
		}
		msg, err <span style="color:#555">:=</span> uc.messageLayer.<span style="color:#c0f">Receive</span>()
		<span style="color:#555">...</span>
		resourceType, err <span style="color:#555">:=</span> messagelayer.<span style="color:#c0f">GetResourceType</span>(msg.<span style="color:#c0f">GetResource</span>())
		<span style="color:#555">...</span>
		<span style="color:#069;font-weight:bold">switch</span> resourceType {
		<span style="color:#069;font-weight:bold">case</span> constants.ResourceTypeTwinEdgeUpdated:
			uc.deviceStatusChan <span style="color:#555">&lt;-</span> msg
		<span style="color:#069;font-weight:bold">default</span>:
			<span style="color:#555">...</span>
		}
	}
}</code></pre></div>
<p>首先接收消息，然后根据消息的<code>resourceType</code>进行转发，也就是把边缘端<code>devicetwin</code>更新上来的消息转发至<code>deviceStatusChan</code>中。</p>

<h4 id="updatedevicestatus">updateDeviceStatus()</h4>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">func</span> (uc <span style="color:#555">*</span>UpstreamController) <span style="color:#c0f">updateDeviceStatus</span>() {
	<span style="color:#069;font-weight:bold">for</span> {
		<span style="color:#069;font-weight:bold">select</span> {
		<span style="color:#069;font-weight:bold">case</span> <span style="color:#555">&lt;-</span>beehiveContext.<span style="color:#c0f">Done</span>():
			klog.<span style="color:#c0f">Info</span>(<span style="color:#c30">&#34;Stop updateDeviceStatus&#34;</span>)
			<span style="color:#069;font-weight:bold">return</span>
		<span style="color:#069;font-weight:bold">case</span> msg <span style="color:#555">:=</span> <span style="color:#555">&lt;-</span>uc.deviceStatusChan:
			<span style="color:#555">...</span>
			msgTwin, err <span style="color:#555">:=</span> uc.<span style="color:#c0f">unmarshalDeviceStatusMessage</span>(msg)
			<span style="color:#555">...</span>
			deviceID, err <span style="color:#555">:=</span> messagelayer.<span style="color:#c0f">GetDeviceID</span>(msg.<span style="color:#c0f">GetResource</span>())
			<span style="color:#555">...</span>
			device, ok <span style="color:#555">:=</span> uc.dc.deviceManager.Device.<span style="color:#c0f">Load</span>(deviceID)
			<span style="color:#555">...</span>
			cacheDevice, ok <span style="color:#555">:=</span> device.(<span style="color:#555">*</span>v1alpha2.Device)
			<span style="color:#555">...</span>
			deviceStatus <span style="color:#555">:=</span> <span style="color:#555">&amp;</span>DeviceStatus{Status: cacheDevice.Status}
			<span style="color:#069;font-weight:bold">for</span> twinName, twin <span style="color:#555">:=</span> <span style="color:#069;font-weight:bold">range</span> msgTwin.Twin {
				<span style="color:#069;font-weight:bold">for</span> i, cacheTwin <span style="color:#555">:=</span> <span style="color:#069;font-weight:bold">range</span> deviceStatus.Status.Twins {
					<span style="color:#069;font-weight:bold">if</span> twinName <span style="color:#555">==</span> cacheTwin.PropertyName <span style="color:#555">&amp;&amp;</span> twin.Actual <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> <span style="color:#555">&amp;&amp;</span> twin.Actual.Value <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
						reported <span style="color:#555">:=</span> v1alpha2.TwinProperty{}
						reported.Value = <span style="color:#555">*</span>twin.Actual.Value
						reported.Metadata = <span style="color:#366">make</span>(<span style="color:#069;font-weight:bold">map</span>[<span style="color:#078;font-weight:bold">string</span>]<span style="color:#078;font-weight:bold">string</span>)
						<span style="color:#069;font-weight:bold">if</span> twin.Actual.Metadata <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
							reported.Metadata[<span style="color:#c30">&#34;timestamp&#34;</span>] = strconv.<span style="color:#c0f">FormatInt</span>(twin.Actual.Metadata.Timestamp, <span style="color:#f60">10</span>)
						}
						<span style="color:#069;font-weight:bold">if</span> twin.Metadata <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
							reported.Metadata[<span style="color:#c30">&#34;type&#34;</span>] = twin.Metadata.Type
						}
						deviceStatus.Status.Twins[i].Reported = reported
						<span style="color:#069;font-weight:bold">break</span>
					}
				}
			}

			<span style="color:#09f;font-style:italic">// Store the status in cache so that when update is received by informer, it is not processed by downstream controller
</span><span style="color:#09f;font-style:italic"></span>			cacheDevice.Status = deviceStatus.Status
			uc.dc.deviceManager.Device.<span style="color:#c0f">Store</span>(deviceID, cacheDevice)

			body, err <span style="color:#555">:=</span> json.<span style="color:#c0f">Marshal</span>(deviceStatus)
			<span style="color:#555">...</span>
			result <span style="color:#555">:=</span> uc.crdClient.<span style="color:#c0f">Patch</span>(MergePatchType).<span style="color:#c0f">Namespace</span>(cacheDevice.Namespace).<span style="color:#c0f">Resource</span>(ResourceTypeDevices).<span style="color:#c0f">Name</span>(deviceID).<span style="color:#c0f">Body</span>(body).<span style="color:#c0f">Do</span>(context.<span style="color:#c0f">Background</span>())
			<span style="color:#555">...</span>
			<span style="color:#09f;font-style:italic">//send confirm message to edge twin
</span><span style="color:#09f;font-style:italic"></span>			resMsg <span style="color:#555">:=</span> model.<span style="color:#c0f">NewMessage</span>(msg.<span style="color:#c0f">GetID</span>())
			nodeID, err <span style="color:#555">:=</span> messagelayer.<span style="color:#c0f">GetNodeID</span>(msg)
			<span style="color:#555">...</span>
			resource, err <span style="color:#555">:=</span> messagelayer.<span style="color:#c0f">BuildResource</span>(nodeID, <span style="color:#c30">&#34;twin&#34;</span>, <span style="color:#c30">&#34;&#34;</span>)
			<span style="color:#555">...</span>
			resMsg.<span style="color:#c0f">BuildRouter</span>(modules.DeviceControllerModuleName, constants.GroupTwin, resource, model.ResponseOperation)
			resMsg.Content = <span style="color:#c30">&#34;OK&#34;</span>
			err = uc.messageLayer.<span style="color:#c0f">Response</span>(<span style="color:#555">*</span>resMsg)
			<span style="color:#555">...</span>
		}
	}
}</code></pre></div>
<p><code>updateDeviceStatus()</code>方法负责更新Device API，即<code>Device.Status</code>部分；然后再给边缘端发一个确认消息。</p>

<h3 id="2-4-总结">2.4. 总结</h3>

<p>DeviceController部分的源码整理如下：</p>

<p><center>
<img src="https://res.cloudinary.com/rachel725/image/upload/v1611567386/sel/devicecontroller_s2vsmm.png" alt="devicecontroller" style="zoom:20%;" />
</center></p>
                        </div>
                        
                        
                        
                        
                        
                        

                        
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
                        <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
                        <script type="text/javascript" src="/assets/js/md5.min.js"></script>
                        <div id="gitalk-container"></div>     
                        <script type="text/javascript">
                            var gitalk = new Gitalk({
                              clientID: '835183d2dcbd1167ac28', 
                            
                              clientSecret: 'd873919fac3cc76921ee0800172c2279bc612f8d', 
                            
                              repo: 'Sel-Website-talk',
                              owner: 'Peeknut',
                              admin: ['Peeknut','Rachel-Shao'],
                              id: location.href.split("/").pop().substring(0, 49),      
                              distractionFreeMode: false  
                            })
                            gitalk.render('gitalk-container')
                        </script> 
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">搜索栏</h3>
      
    </div>

    <div class="panel-body">
        
        <div class="search" id="search">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="请输入文章标题或摘要..." id="search-key">
                <input type="hidden" name="sitesearch" value="https://Congrool.github.io/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main" onclick="search()"><i class="fas fa-search"></i></button>
                </span>
            </div>
            <h1 id="search-tip" style="color: red;text-align: center;display: none;font-size: medium;">搜索中，请稍后 ...</h1>
        </div>
        <script type="text/javascript">
            
            window.onload = function() {
                      document.onkeydown = function(ev) {
                        var event = ev || event
                        if (event.keyCode == 13) {
                          search()
                        }
                      }
                    }
            
            function search() {
                    
                      key = document.getElementById("search-key").value;
                      if (key === "") {
                        
                        return;
                      }
                      key = key.toLowerCase();
                      document.getElementById("search-key").value = "";
                  
                      
                      document.getElementById("search-tip").innerText = "搜索中，请稍后 ...";
                      document.getElementById("search-tip").style.display = "block";
                  
                      
                      var el = document.getElementById('blog-listing-medium');
                      if (el == null) {
                        el = document.getElementById("blog-post")
                      }
                      var childs = el.childNodes;
                      for (var i = childs.length - 1; i >= 0; i--) {
                        el.removeChild(childs[i]);
                      }
                  
                      
                      xmltext = new XMLHttpRequest;
                      xmltext.open("GET", "/index.xml", false);
                      xmltext.send();
                      resp = xmltext.responseXML;
                      
                      items = resp.getElementsByTagName("item");
                      
                      var i = 0;
                      haveResult = false;
                      while (i < items.length) {
                        txt = items[i].getElementsByTagName("title")[0].innerHTML + items[i].getElementsByTagName("description")[0].innerHTML
                        txt = txt.toLowerCase();
                        if (txt.indexOf(key) > -1) {
                          haveResult = true;
                          title = items[i].getElementsByTagName("title")[0].innerHTML;
                          link = items[i].getElementsByTagName("link")[0].innerHTML;
                          time = items[i].getElementsByTagName("pubDate")[0].innerHTML;
                          mark = items[i].getElementsByTagName("description")[0].innerHTML;
                          time = time.slice(0, -5);
                          addItem(title, link, time, mark)
                        }
                        i++;
                      }
                      if (!haveResult) {
                        document.getElementById("search-tip").innerText = "搜索完毕，未发现结果 ...";
                        document.getElementById("search-tip").style.display = "block";
                      }

                      
                      var el = document.getElementById("blog-head");
                      el.innerHTML="Blogs"
                    }
                  
                    
                    function addItem(title, link, time, mark) {
                      document.getElementById("search-tip").style.display = "none";
                      tmpl = "<article class=\"post\" style=\"border-bottom: 1px solid #e6e6e6;\" >" +
                        "<header class=\"post-header\">" +
                        "<h1 class=\"post-title\"><a class=\"post-link\" href=\"" + link + "\" target=\"_blank\">" + title + "</a></h1>" +
                        "<div class=\"post-meta\">" +
                        " <span class=\"post-time\">" + time + "</span>" +
                        "</div>" +
                        " </header>" +
                        "<div class=\"post-content\">" +
                        "<div class=\"post-summary\">" + mark + "</div>" +
                        "<div class=\"read-more\">" +
                        "<a href=" + link + " class=\"read-more-link\" target=\"_blank\">阅读更多</a>" +
                        "</div>" +
                        " </div>" +
                        "</article>"
                      div = document.createElement("div")
                      div.innerHTML = tmpl;
                      var el = document.getElementById('blog-listing-medium');
                      if (el == null) {
                        el = document.getElementById("blog-post")
                      }
                      el.appendChild(div)
                    }
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    

        </script>
        
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">归档栏</h3>
        
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            
            <li>
                <a href="/categories/bosh">bosh (1)</a>
            </li>
            
            <li>
                <a href="/categories/cloud_controller_ng">cloud_controller_ng (1)</a>
            </li>
            
            <li>
                <a href="/categories/cloudfoundry">cloudfoundry (15)</a>
            </li>
            
            <li>
                <a href="/categories/containerd">containerd (1)</a>
            </li>
            
            <li>
                <a href="/categories/docker">docker (19)</a>
            </li>
            
            <li>
                <a href="/categories/etcd">etcd (1)</a>
            </li>
            
            <li>
                <a href="/categories/haproxy">haproxy (1)</a>
            </li>
            
            <li>
                <a href="/categories/healthmanager">healthmanager (1)</a>
            </li>
            
            <li>
                <a href="/categories/karmada">karmada (4)</a>
            </li>
            
            <li>
                <a href="/categories/kubeedge">kubeedge (5)</a>
            </li>
            
            <li>
                <a href="/categories/kubernetes">kubernetes (14)</a>
            </li>
            
            <li>
                <a href="/categories/network">network (1)</a>
            </li>
            
            <li>
                <a href="/categories/openyurt">openyurt (2)</a>
            </li>
            
            <li>
                <a href="/categories/service-mesh">service-mesh (4)</a>
            </li>
            
        </ul>
    </div>

</div>








<div class="panel sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">标签栏</h3>
        
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            
            <li>
                <a href="/tags/agent"><i class="fas fa-tags"></i> agent</a>
            </li>
            
            <li>
                <a href="/tags/apiserver"><i class="fas fa-tags"></i> apiserver</a>
            </li>
            
            <li>
                <a href="/tags/books"><i class="fas fa-tags"></i> books</a>
            </li>
            
            <li>
                <a href="/tags/bosh"><i class="fas fa-tags"></i> bosh</a>
            </li>
            
            <li>
                <a href="/tags/ccng"><i class="fas fa-tags"></i> ccng</a>
            </li>
            
            <li>
                <a href="/tags/cf-release"><i class="fas fa-tags"></i> cf-release</a>
            </li>
            
            <li>
                <a href="/tags/cgroups"><i class="fas fa-tags"></i> cgroups</a>
            </li>
            
            <li>
                <a href="/tags/cloudfoundry"><i class="fas fa-tags"></i> cloudfoundry</a>
            </li>
            
            <li>
                <a href="/tags/cloudnative"><i class="fas fa-tags"></i> cloudnative</a>
            </li>
            
            <li>
                <a href="/tags/collector"><i class="fas fa-tags"></i> collector</a>
            </li>
            
            <li>
                <a href="/tags/containerd"><i class="fas fa-tags"></i> containerd</a>
            </li>
            
            <li>
                <a href="/tags/cri"><i class="fas fa-tags"></i> cri</a>
            </li>
            
            <li>
                <a href="/tags/dea"><i class="fas fa-tags"></i> dea</a>
            </li>
            
            <li>
                <a href="/tags/docker"><i class="fas fa-tags"></i> docker</a>
            </li>
            
            <li>
                <a href="/tags/docker-network"><i class="fas fa-tags"></i> docker-network</a>
            </li>
            
            <li>
                <a href="/tags/edgecomputing"><i class="fas fa-tags"></i> edgecomputing</a>
            </li>
            
            <li>
                <a href="/tags/etcd"><i class="fas fa-tags"></i> etcd</a>
            </li>
            
            <li>
                <a href="/tags/gorouter"><i class="fas fa-tags"></i> gorouter</a>
            </li>
            
            <li>
                <a href="/tags/haproxy"><i class="fas fa-tags"></i> haproxy</a>
            </li>
            
            <li>
                <a href="/tags/healthmanager"><i class="fas fa-tags"></i> healthmanager</a>
            </li>
            
            <li>
                <a href="/tags/istio"><i class="fas fa-tags"></i> istio</a>
            </li>
            
            <li>
                <a href="/tags/karmada"><i class="fas fa-tags"></i> karmada</a>
            </li>
            
            <li>
                <a href="/tags/kubeedge"><i class="fas fa-tags"></i> kubeedge</a>
            </li>
            
            <li>
                <a href="/tags/kubelet"><i class="fas fa-tags"></i> kubelet</a>
            </li>
            
            <li>
                <a href="/tags/kubernetes"><i class="fas fa-tags"></i> kubernetes</a>
            </li>
            
            <li>
                <a href="/tags/libcontainer"><i class="fas fa-tags"></i> libcontainer</a>
            </li>
            
            <li>
                <a href="/tags/micro-service"><i class="fas fa-tags"></i> micro-service</a>
            </li>
            
            <li>
                <a href="/tags/namespace"><i class="fas fa-tags"></i> namespace</a>
            </li>
            
            <li>
                <a href="/tags/nats"><i class="fas fa-tags"></i> nats</a>
            </li>
            
            <li>
                <a href="/tags/news"><i class="fas fa-tags"></i> news</a>
            </li>
            
            <li>
                <a href="/tags/openyurt"><i class="fas fa-tags"></i> openyurt</a>
            </li>
            
            <li>
                <a href="/tags/pipework"><i class="fas fa-tags"></i> pipework</a>
            </li>
            
            <li>
                <a href="/tags/pouch"><i class="fas fa-tags"></i> pouch</a>
            </li>
            
            <li>
                <a href="/tags/runc"><i class="fas fa-tags"></i> runc</a>
            </li>
            
            <li>
                <a href="/tags/runtime"><i class="fas fa-tags"></i> runtime</a>
            </li>
            
            <li>
                <a href="/tags/security"><i class="fas fa-tags"></i> security</a>
            </li>
            
            <li>
                <a href="/tags/serverless"><i class="fas fa-tags"></i> serverless</a>
            </li>
            
            <li>
                <a href="/tags/service-mesh"><i class="fas fa-tags"></i> service-mesh</a>
            </li>
            
            <li>
                <a href="/tags/syslog_aggregator"><i class="fas fa-tags"></i> syslog_aggregator</a>
            </li>
            
        </ul>
    </div>

</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4></h4>

            <p><strong>关于我们：<strong> <p>浙大SEL实验室</p><p>地址：杭州市浙大路38号曹光彪西楼405室</p><p><strong></strong>
            <a href="/contact" class="btn btn-small btn-template-main" >跳转到关于</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>最新博客</h4>
            

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://Congrool.github.io/blog/2022/08/26/%E5%9F%BA%E4%BA%8Ekubeedge%E7%9A%84%E8%BE%B9%E7%BC%98%E8%8A%82%E7%82%B9%E5%88%86%E7%BB%84%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">
                          
                            <img src="/img/blogs/27/overview.png" class="img-responsive" alt="基于KubeEdge的边缘节点分组管理设计与实现">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://Congrool.github.io/blog/2022/08/26/%E5%9F%BA%E4%BA%8Ekubeedge%E7%9A%84%E8%BE%B9%E7%BC%98%E8%8A%82%E7%82%B9%E5%88%86%E7%BB%84%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">基于KubeEdge的边缘节点分组管理设计与实现</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://Congrool.github.io/blog/2021/09/22/%E5%A4%9A%E4%BA%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6karmada-scheduler%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E5%AE%9E%E7%8E%B0/">
                          
                            <img src="/img/blogs/20/karmada-scheduler.png" class="img-responsive" alt="多云环境下的资源调度：karmada scheduler的框架和实现">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://Congrool.github.io/blog/2021/09/22/%E5%A4%9A%E4%BA%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6karmada-scheduler%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E5%AE%9E%E7%8E%B0/">多云环境下的资源调度：karmada scheduler的框架和实现</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://Congrool.github.io/blog/2021/09/16/%E5%A4%9A%E4%BA%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E6%88%90%E5%91%98%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%9C%8B%E7%9C%8B%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEkarmada%E6%98%AF%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E7%9A%84/">
                          
                            <img src="/img/blogs/19/karmada-arch.jpg" class="img-responsive" alt="多云环境下的成员集群管理，看看开源项目karmada是如何做到的">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://Congrool.github.io/blog/2021/09/16/%E5%A4%9A%E4%BA%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E6%88%90%E5%91%98%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%9C%8B%E7%9C%8B%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEkarmada%E6%98%AF%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E7%9A%84/">多云环境下的成员集群管理，看看开源项目karmada是如何做到的</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4></h4>

            <p><strong>联系我们: 
                                    <p>团队负责人：丁轶群 yiqunding@zju.edu.cn</p>
                                    <p>网站维护人：刘佳文 839809484@qq.com</p>                
    </strong>

            

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright ©️ 2020 SEL Laboratory , ZJ University all rights reserved.</p>
            
            <p class="pull-right">
               <a href="https://bootstrapious.com/p/universal-business-e-commerce-template">Bootstrapious</a>.
              

               <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>.
            </p>
        </div>
    </div>
</div>





    </div>
    

    


<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>



<script src="/js/jquery.cookie.min.js"></script>
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.counterup.min.js"></script>
<script src="/js/jquery-parallax.js"></script>


<script src="/js/front.js"></script>


<script src="/js/owl.carousel.min.js"></script>



  </body>
</html>
